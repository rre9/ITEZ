@model ITHelpDesk.Models.Assets.MobileDevice
@inject Microsoft.AspNetCore.Mvc.Localization.IViewLocalizer Localizer
@{
    ViewData["Title"] = Localizer["Edit Mobile Device"];
}

<style>
    .select-with-add {
        position: relative;
        display: flex;
        align-items: stretch;
    }

    .select-with-add .form-select {
        flex: 1;
        border-top-right-radius: 0;
        border-bottom-right-radius: 0;
        border-right: none;
        padding-right: 2.5rem;
        appearance: none;
        background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%23343a40' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='m2 5 6 6 6-6'/%3e%3c/svg%3e");
        background-repeat: no-repeat;
        background-position: right 0.75rem center;
        background-size: 16px 12px;
    }

    .select-with-add .btn-add {
        border-top-left-radius: 0;
        border-bottom-left-radius: 0;
        padding: 0.5rem 0.75rem;
        display: flex;
        align-items: center;
        justify-content: center;
        min-width: 45px;
        background: #f8f9fa;
        border: 1px solid #ced4da;
        color: #495057;
        transition: all 0.2s ease;
        font-size: 1.2rem;
        font-weight: bold;
    }

    .select-with-add .btn-add:hover {
        background: #0066cc;
        border-color: #0066cc;
        color: white;
    }

    .select-with-add .btn-add::before {
        content: '+';
        font-size: 1.3rem;
        font-weight: 600;
        line-height: 1;
    }

    /* Required/Optional Field Indicators */
    .field-required {
        color: #dc3545;
        font-weight: 600;
    }

    .field-optional {
        color: #6c757d;
        font-size: 0.875rem;
        font-weight: 500;
    }

    /* Validation styling */
    .form-control.is-invalid-empty,
    .form-select.is-invalid-empty {
        /* Border removed - only show error message */
    }

    .form-control.is-invalid-empty:focus,
    .form-select.is-invalid-empty:focus {
        /* Border removed - only show error message */
    }

    .form-error-message {
        display: block;
        color: #dc3545;
        font-size: 0.875rem;
        margin-top: 0.25rem;
        font-weight: 500;
    }

    .submit-validation-hidden {
        display: none;
    }

    /* RTL Support for select-with-add */
    [dir="rtl"] .select-with-add .form-select {
        border-top-left-radius: 0;
        border-bottom-left-radius: 0;
        border-top-right-radius: var(--bs-border-radius, 0.375rem);
        border-bottom-right-radius: var(--bs-border-radius, 0.375rem);
        border-left: none;
        border-right: 1px solid #ced4da;
        padding-left: 2.5rem;
        padding-right: 0.75rem;
        background-position: left 0.75rem center;
    }

    [dir="rtl"] .select-with-add .btn-add {
        border-top-left-radius: var(--bs-border-radius, 0.375rem);
        border-bottom-left-radius: var(--bs-border-radius, 0.375rem);
        border-top-right-radius: 0;
        border-bottom-right-radius: 0;
    }
</style>

<div class="container-fluid py-4">
    <div class="row">
        <div class="col-12">
            <div class="card mb-4">
                <div class="card-header pb-0">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5>@Localizer["Edit Mobile Device"]</h5>
                        @* <a asp-action="Mobiles" class="btn btn-secondary btn-sm">
                            <i class="fa-solid fa-arrow-left me-1"></i>
                            Back
                        </a> *@
                    </div>
                </div>
                <div class="card-body">
                    <form asp-action="EditMobile" method="post">
                        @Html.AntiForgeryToken()
                        <input type="hidden" asp-for="Id" />
                        <input type="hidden" name="AssetStateId" value="@Model.AssetStateId" />
                        <input type="hidden" name="AssetState.Id" value="@Model.AssetState?.Id" />
                        <input type="hidden" name="MobileDetailsId" value="@Model.MobileDetailsId" />
                        <input type="hidden" name="MobileDetails.Id" value="@Model.MobileDetails?.Id" />
                        <input type="hidden" name="OperatingSystemInfoId" value="@Model.OperatingSystemInfoId" />
                        <input type="hidden" name="OperatingSystemInfo.Id" value="@Model.OperatingSystemInfo?.Id" />
                        <input type="hidden" name="NetworkDetailsId" value="@Model.NetworkDetailsId" />
                        <input type="hidden" name="NetworkDetails.Id" value="@Model.NetworkDetails?.Id" />

                        <!-- Basic Information Section -->
                        <div class="card mb-3">
                            <div class="card-body">
                                <h6 class="text-sm mb-3 fw-bold">@Localizer["Basic Information"]</h6>
                                <div class="row">
                                    <!-- Basic Information -->
                                    <div class="col-md-6 mb-3">
                                        <label asp-for="Name" class="form-label">
                                            @Localizer["Name"]
                                            <span class="field-required">*</span>
                                        </label>
                                        <input asp-for="Name" class="form-control" required data-required="true" />
                                        <span asp-validation-for="Name" class="text-danger"></span>
                                        <span class="form-error-message submit-validation-hidden"
                                            id="Name-required">@Localizer["This field is required"]</span>
                                    </div>

                                    <div class="col-md-6 mb-3">
                                        <label asp-for="ProductId" class="form-label">
                                            @Localizer["Product"]
                                            <span class="field-required">*</span>
                                        </label>
                                        <div class="select-with-add">
                                            <select asp-for="ProductId" class="form-select" required
                                                data-required="true">
                                                <option value="">-- @Localizer["SelectProduct"] --</option>
                                                @if (ViewBag.Products != null)
                                                {
                                                    @foreach (var product in ViewBag.Products as
                                                                                                    List<ITHelpDesk.Models.Assets.Product>)
                                                    {
                                                        <option value="@product.Id">@product.ProductName - @product.Manufacturer
                                                        </option>
                                                    }
                                                }
                                            </select>
                                            <button type="button" class="btn btn-add" data-bs-toggle="modal"
                                                data-bs-target="#addProductModal" title="Add New Product"></button>
                                        </div>
                                        <span asp-validation-for="ProductId" class="text-danger"></span>
                                        <span class="form-error-message submit-validation-hidden"
                                            id="ProductId-required">@Localizer["This field is required"]</span>
                                    </div>

                                    <!-- Asset Details -->
                                    <div class="col-md-12 mt-3">
                                        <h6 class="text-sm mb-3 fw-bold">@Localizer["Asset Details"]</h6>
                                    </div>

                                    <div class="col-md-6 mb-3">
                                        <label asp-for="SerialNumber" class="form-label">
                                            @Localizer["Serial Number"]
                                            <span class="field-required">*</span>
                                        </label>
                                        <input asp-for="SerialNumber" class="form-control" required
                                            data-required="true" />
                                        <span asp-validation-for="SerialNumber" class="text-danger"></span>
                                        <span class="form-error-message submit-validation-hidden"
                                            id="SerialNumber-required">@Localizer["This field is required"]</span>
                                    </div>

                                    <div class="col-md-6 mb-3">
                                        <label asp-for="AssetTag" class="form-label">
                                            @Localizer["Asset Tag"]
                                            <span class="field-optional">(@Localizer["Optional"])</span>
                                        </label>
                                        <input asp-for="AssetTag" class="form-control" />
                                        <span asp-validation-for="AssetTag" class="text-danger"></span>
                                    </div>

                                    <div class="col-md-6 mb-3">
                                        <label asp-for="VendorId" class="form-label">
                                            @Localizer["Vendor"]
                                            <span class="field-required">*</span>
                                        </label>
                                        <div class="select-with-add">
                                            <select asp-for="VendorId" class="form-select" required
                                                data-required="true">
                                                <option value="">-- @Localizer["SelectVendor"] --</option>
                                                @foreach (var vendor in (ViewBag.Vendors as
                                                                                                List<ITHelpDesk.Models.Assets.Vendor>) ?? new
                                                                                                List<ITHelpDesk.Models.Assets.Vendor>())
                                                {
                                                    <option value="@vendor.Id">@vendor.VendorName</option>
                                                }
                                            </select>
                                            <button type="button" class="btn btn-add" data-bs-toggle="modal"
                                                data-bs-target="#addVendorModal" title="Add New Vendor"></button>
                                        </div>
                                        <span asp-validation-for="VendorId" class="text-danger"></span>
                                        <span class="form-error-message submit-validation-hidden"
                                            id="VendorId-required">@Localizer["This field is required"]</span>
                                    </div>

                                    <div class="col-md-6 mb-3">
                                        <label asp-for="PurchaseCost" class="form-label">
                                            @Localizer["Purchase Cost"] (@Localizer["SAR"])
                                            <span class="field-required">*</span>
                                        </label>
                                        <input asp-for="PurchaseCost" type="number" step="0.01" class="form-control"
                                            required data-required="true" />
                                        <span asp-validation-for="PurchaseCost" class="text-danger"></span>
                                        <span class="form-error-message submit-validation-hidden"
                                            id="PurchaseCost-required">@Localizer["This field is required"]</span>
                                    </div>

                                    <div class="col-md-6 mb-3">
                                        <label asp-for="ExpiryDate" class="form-label">
                                            @Localizer["Expiry Date"]
                                            <span class="field-required">*</span>
                                        </label>
                                        <input asp-for="ExpiryDate" type="date" class="form-control" required
                                            data-required="true" />
                                        <span asp-validation-for="ExpiryDate" class="text-danger"></span>
                                        <span class="form-error-message submit-validation-hidden"
                                            id="ExpiryDate-required">@Localizer["This field is required"]</span>
                                    </div>

                                    <div class="col-md-6 mb-3">
                                        <label asp-for="Location" class="form-label">
                                            @Localizer["Location"]
                                            <span class="field-optional">(@Localizer["Optional"])</span>
                                        </label>
                                        <input asp-for="Location" class="form-control" />
                                        <span asp-validation-for="Location" class="text-danger"></span>
                                    </div>

                                    <div class="col-md-6 mb-3">
                                        <label asp-for="AcquisitionDate" class="form-label">
                                            @Localizer["Acquisition Date"]
                                            <span class="field-required">*</span>
                                        </label>
                                        <input asp-for="AcquisitionDate" type="date" class="form-control" required
                                            data-required="true" />
                                        <span asp-validation-for="AcquisitionDate" class="text-danger"></span>
                                        <span class="form-error-message submit-validation-hidden"
                                            id="AcquisitionDate-required">@Localizer["This field is required"]</span>
                                    </div>

                                    <div class="col-md-6 mb-3">
                                        <label asp-for="WarrantyExpiryDate" class="form-label">
                                            @Localizer["Warranty Expiry Date"]
                                            <span class="field-required">*</span>
                                        </label>
                                        <input asp-for="WarrantyExpiryDate" type="date" class="form-control" required
                                            data-required="true" />
                                        <span asp-validation-for="WarrantyExpiryDate" class="text-danger"></span>
                                        <span class="form-error-message submit-validation-hidden"
                                            id="WarrantyExpiryDate-required">@Localizer["This field is required"]</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Mobile Details Section -->
                        <div class="card mb-3">
                            <div class="card-body">
                                <h6 class="text-sm mb-3 fw-bold">@Localizer["Mobile Device Information"]</h6>
                                <div class="row">

                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">
                                            IMEI
                                            <span class="field-required">*</span>
                                        </label>
                                        <input type="text" name="MobileDetails.IMEI" value="@Model.MobileDetails?.IMEI"
                                            class="form-control" required data-required="true" />
                                        <span class="form-error-message submit-validation-hidden"
                                            id="IMEI-required">@Localizer["This field is required"]</span>
                                    </div>

                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">
                                            @Localizer["Model"]
                                            <span class="field-required">*</span>
                                        </label>
                                        <input type="text" name="MobileDetails.Model"
                                            value="@Model.MobileDetails?.Model" class="form-control" required
                                            data-required="true"/>
                                        <span class="form-error-message submit-validation-hidden"
                                            id="Model-required">@Localizer["This field is required"]</span>
                                    </div>

                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">
                                            @Localizer["Model Number"]
                                            <span class="field-required">*</span>
                                        </label>
                                        <input type="text" name="MobileDetails.ModelNo"
                                            value="@Model.MobileDetails?.ModelNo" class="form-control" required
                                            data-required="true" />
                                        <span class="form-error-message submit-validation-hidden"
                                            id="ModelNo-required">@Localizer["This field is required"]</span>
                                    </div>

                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">
                                            @Localizer["Total Capacity"] (GB)
                                            <span class="field-required">*</span>
                                        </label>
                                        <input type="number" name="MobileDetails.TotalCapacityGB"
                                            value="@Model.MobileDetails?.TotalCapacityGB" class="form-control" required
                                            data-required="true" />
                                        <span class="form-error-message submit-validation-hidden"
                                            id="TotalCapacityGB-required">@Localizer["This field is required"]</span>
                                    </div>

                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">
                                            @Localizer["Available Capacity"] (GB)
                                            <span class="field-required">*</span>
                                        </label>
                                        <input type="number" name="MobileDetails.AvailableCapacityGB"
                                            value="@Model.MobileDetails?.AvailableCapacityGB" class="form-control"
                                            required data-required="true" />
                                        <span class="form-error-message submit-validation-hidden"
                                            id="AvailableCapacityGB-required">@Localizer["This field is required"]</span>
                                    </div>

                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">
                                            @Localizer["Modem Firmware Version"]
                                            <span class="field-optional">(@Localizer["Optional"])</span>
                                        </label>
                                        <input type="text" name="MobileDetails.ModemFirmwareVersion"
                                            value="@Model.MobileDetails?.ModemFirmwareVersion" class="form-control" />
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Operating System Info Section -->
                        <div class="card mb-3">
                            <div class="card-body">
                                <h6 class="text-sm mb-3 fw-bold">@Localizer["Operating System Information"]</h6>
                                <div class="row">

                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">@Localizer["OS Name"]</label>
                                        <input type="text" name="OperatingSystemInfo.Name"
                                            value="@Model.OperatingSystemInfo?.Name" class="form-control"
                                            placeholder="e.g., iOS, Android" />
                                    </div>

                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">@Localizer["OS Version"]</label>
                                        <input type="text" name="OperatingSystemInfo.Version"
                                            value="@Model.OperatingSystemInfo?.Version" class="form-control" />
                                    </div>

                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">@Localizer["Build Number"]</label>
                                        <input type="text" name="OperatingSystemInfo.BuildNumber"
                                            value="@Model.OperatingSystemInfo?.BuildNumber" class="form-control" />
                                    </div>

                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">@Localizer["Service Pack"]</label>
                                        <input type="text" name="OperatingSystemInfo.ServicePack"
                                            value="@Model.OperatingSystemInfo?.ServicePack" class="form-control" />
                                    </div>

                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">@Localizer["Product ID"]</label>
                                        <input type="text" name="OperatingSystemInfo.ProductId"
                                            value="@Model.OperatingSystemInfo?.ProductId" class="form-control" />
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Asset State Section -->
                        <div class="card mb-3">
                            <div class="card-body">
                                <h6 class="text-sm mb-3 fw-bold">@Localizer["Asset State"]</h6>
                                <div class="row">

                                    <div class="col-md-6 mb-3">
                                                    <label class="form-label">@Localizer["AssetStatus"] <span class="field-required">*</span></label>
                                                    <select name="AssetState.Status" class="form-select" required data-required="true">
                                                        <option value="">-- @Localizer["SelectStatus"] --</option>
                                                        <option value="1" selected="@(Model.AssetState?.Status == ITHelpDesk.Models.Assets.AssetStatusEnum.InStore)">@Localizer["InStore"]</option>
                                                        <option value="2" selected="@(Model.AssetState?.Status == ITHelpDesk.Models.Assets.AssetStatusEnum.InUse)">@Localizer["InUse"]</option>
                                                        <option value="3" selected="@(Model.AssetState?.Status == ITHelpDesk.Models.Assets.AssetStatusEnum.InRepair)">@Localizer["InRepair"]</option>
                                                        <option value="4" selected="@(Model.AssetState?.Status == ITHelpDesk.Models.Assets.AssetStatusEnum.Expired)">@Localizer["Expired"]</option>
                                                        <option value="5" selected="@(Model.AssetState?.Status == ITHelpDesk.Models.Assets.AssetStatusEnum.Disposed)">@Localizer["Disposed"]</option>
                                                    </select>
                                      
                                        <span class="form-error-message submit-validation-hidden"
                                            id="Status-required">@Localizer["This field is required"]</span>
                                    </div>

                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">
                                            @Localizer["Associated To"]
                                            <span class="field-optional">(@Localizer["Optional"])</span>
                                        </label>
                                        <input type="text" name="AssetState.AssociatedTo"
                                            value="@Model.AssetState?.AssociatedTo" class="form-control" />
                                    </div>

                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">
                                            @Localizer["Site"]
                                            <span class="field-optional">(@Localizer["Optional"])</span>
                                        </label>
                                        <input type="text" name="AssetState.Site" value="@Model.AssetState?.Site"
                                            class="form-control" />
                                    </div>

                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">
                                            @Localizer["State Comments"]
                                            <span class="field-optional">(@Localizer["Optional"])</span>
                                        </label>
                                        <textarea name="AssetState.StateComments" class="form-control"
                                            rows="2">@Model.AssetState?.StateComments</textarea>
                                    </div>

                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">
                                            @Localizer["User ID"]
                                            <span class="field-optional">(@Localizer["Optional"])</span>
                                        </label>
                                        <input type="text" name="AssetState.UserId" value="@Model.AssetState?.UserId"
                                            class="form-control" />
                                    </div>

                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">
                                            @Localizer["Department"]
                                            <span class="field-required">*</span>
                                        </label>
                                        <input type="text" name="AssetState.Department"
                                            value="@Model.AssetState?.Department" class="form-control" required
                                            data-required="true" />
                                        <span class="form-error-message submit-validation-hidden"
                                            id="Department-required">@Localizer["This field is required"]</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Network Details Section -->
                        <div class="card mb-3">
                            <div class="card-body">
                                <h6 class="text-sm mb-3 fw-bold">@Localizer["Network Details"]</h6>
                                <div class="row">

                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">
                                            @Localizer["IP Address"]
                                            <span class="field-required">*</span>
                                        </label>
                                        <input type="text" name="NetworkDetails.IPAddress"
                                            value="@Model.NetworkDetails?.IPAddress" class="form-control" required
                                            data-required="true" />
                                        <span class="form-error-message submit-validation-hidden"
                                            id="IPAddress-required">@Localizer["This field is required"]</span>
                                    </div>

                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">
                                            @Localizer["MAC Address"]
                                            <span class="field-required">*</span>
                                        </label>
                                        <input type="text" name="NetworkDetails.MACAddress"
                                            value="@Model.NetworkDetails?.MACAddress" class="form-control" required
                                            data-required="true" />
                                        <span class="form-error-message submit-validation-hidden"
                                            id="MACAddress-required">@Localizer["This field is required"]</span>
                                    </div>

                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">
                                            @Localizer["NIC"]
                                            <span class="field-optional">(@Localizer["Optional"])</span>
                                        </label>
                                        <input type="text" name="NetworkDetails.NIC" value="@Model.NetworkDetails?.NIC"
                                            class="form-control" />
                                    </div>

                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">
                                            @Localizer["Network"]
                                            <span class="field-optional">(@Localizer["Optional"])</span>
                                        </label>
                                        <input type="text" name="NetworkDetails.Network"
                                            value="@Model.NetworkDetails?.Network" class="form-control" />
                                    </div>

                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">
                                            @Localizer["Default Gateway"]
                                            <span class="field-optional">(@Localizer["Optional"])</span>
                                        </label>
                                        <input type="text" name="NetworkDetails.DefaultGateway"
                                            value="@Model.NetworkDetails?.DefaultGateway" class="form-control" />
                                    </div>

                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">
                                            @Localizer["DHCP Enabled"]
                                            <span class="field-required">*</span>
                                        </label>
                                        <select name="NetworkDetails.DHCPEnabled" class="form-select" required
                                            data-required="true">
                                            <option value="false"
                                                selected="@(Model.NetworkDetails?.DHCPEnabled != true)">@Localizer["No"]</option>
                                            <option value="true"
                                                selected="@(Model.NetworkDetails?.DHCPEnabled == true)">@Localizer["Yes"]</option>
                                        </select>
                                        <span class="form-error-message submit-validation-hidden"
                                            id="DHCPEnabled-required">@Localizer["This field is required"]</span>
                                    </div>

                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">
                                            @Localizer["DHCP Server"]
                                            <span class="field-optional">(@Localizer["Optional"])</span>
                                        </label>
                                        <input type="text" name="NetworkDetails.DHCPServer"
                                            value="@Model.NetworkDetails?.DHCPServer" class="form-control" />
                                    </div>

                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">
                                            @Localizer["DNS Hostname"]
                                            <span class="field-optional">(@Localizer["Optional"])</span>
                                        </label>
                                        <input type="text" name="NetworkDetails.DNSHostname"
                                            value="@Model.NetworkDetails?.DNSHostname" class="form-control" />
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Submit Buttons -->
                        <div class="row mt-4">
                            <div class="col-12">
                                <div class="d-flex justify-content-end gap-2">
                                    <a asp-action="Mobiles" class="btn btn-secondary">
                                        <i class="fa-solid fa-times me-1"></i>@Localizer["Cancel"]
                                    </a>
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fa-solid fa-save me-1"></i>@Localizer["Update Mobile Device"]
                                    </button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }

    <script>
        // Form validation on submit
        document.addEventListener('DOMContentLoaded', function () {
            const form = document.querySelector('form[action*="EditMobile"]');
            if (form) {
                form.addEventListener('submit', function (e) {
                    const requiredFields = ['Name', 'ProductId', 'SerialNumber', 'VendorId', 'PurchaseCost', 'ExpiryDate', 'AcquisitionDate', 'WarrantyExpiryDate', 'IMEI', 'Model', 'ModelNo', 'TotalCapacityGB', 'AvailableCapacityGB', 'Status', 'Department', 'IPAddress', 'MACAddress', 'DHCPEnabled'];
                    let hasErrors = false;

                    // Check required fields
                    requiredFields.forEach(fieldName => {
                        const input = document.querySelector(`[name*="${fieldName}"]`);
                        const errorSpan = document.getElementById(`${fieldName}-required`);

                        if (input && input.value.trim() === '') {
                            input.classList.add('is-invalid-empty');
                            if (errorSpan) {
                                errorSpan.classList.remove('submit-validation-hidden');
                            }
                            hasErrors = true;
                        } else if (input) {
                            input.classList.remove('is-invalid-empty');
                            if (errorSpan) {
                                errorSpan.classList.add('submit-validation-hidden');
                            }
                        }
                    });

                    // Prevent submission if there are errors
                    if (hasErrors) {
                        e.preventDefault();
                        // Scroll to first error
                        const firstError = document.querySelector('.is-invalid-empty');
                        if (firstError) {
                            firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
                            firstError.focus();
                        }
                    }
                });

                // Real-time validation on field change/blur
                const requiredFields = ['Name', 'ProductId', 'SerialNumber', 'VendorId', 'PurchaseCost', 'ExpiryDate', 'AcquisitionDate', 'WarrantyExpiryDate', 'IMEI', 'Model', 'ModelNo', 'TotalCapacityGB', 'AvailableCapacityGB', 'Status', 'Department', 'IPAddress', 'MACAddress', 'DHCPEnabled'];
                requiredFields.forEach(fieldName => {
                    const input = document.querySelector(`[name*="${fieldName}"]`);
                    if (input) {
                        ['blur', 'change'].forEach(event => {
                            input.addEventListener(event, function () {
                                const errorSpan = document.getElementById(`${fieldName}-required`);
                                if (input.value.trim() === '') {
                                    input.classList.add('is-invalid-empty');
                                    if (errorSpan) {
                                        errorSpan.classList.remove('submit-validation-hidden');
                                    }
                                } else {
                                    input.classList.remove('is-invalid-empty');
                                    if (errorSpan) {
                                        errorSpan.classList.add('submit-validation-hidden');
                                    }
                                }
                            });
                        });
                    }
                });
            }
        });
    </script>
}

<!-- Modal Add New Product -->
<div class="modal fade" id="addProductModal" tabindex="-1" aria-labelledby="addProductModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addProductModalLabel">@Localizer["Add New Product"]</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="addProductForm">
                    <div class="mb-3">
                        <label for="productType" class="form-label">@Localizer["Product Type"] <span
                                class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="productType" value="Mobile" required>
                    </div>
                    <div class="mb-3">
                        <label for="productName" class="form-label">@Localizer["Product Name"] <span
                                class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="productName" required>
                    </div>
                    <div class="mb-3">
                        <label for="manufacturer" class="form-label">@Localizer["Manufacturer"] <span
                                class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="manufacturer" required>
                    </div>
                    <div class="mb-3">
                        <label for="partNo" class="form-label">@Localizer["Part Number"]</label>
                        <input type="text" class="form-control" id="partNo">
                    </div>
                    <div class="mb-3">
                        <label for="cost" class="form-label">@Localizer["Cost"] (@Localizer["SAR"])</label>
                        <input type="number" step="0.01" class="form-control" id="cost" value="0">
                    </div>
                    <div class="mb-3">
                        <label for="description" class="form-label">@Localizer["Description"]</label>
                        <textarea class="form-control" id="description" rows="3"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times me-1"></i>
                    @Localizer["Cancel"]
                </button>
                <button type="button" class="btn btn-primary" onclick="saveProduct()">
                    <i class="fas fa-save me-1"></i>
                    @Localizer["Save"]
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal Add New Vendor -->
<div class="modal fade" id="addVendorModal" tabindex="-1" aria-labelledby="addVendorModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addVendorModalLabel">@Localizer["Add New Vendor"]</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="addVendorForm">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="vendorName" class="form-label">@Localizer["Vendor Name"] <span
                                    class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="vendorName" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="vendorPhone" class="form-label">@Localizer["Phone"]</label>
                            <input type="tel" class="form-control" id="vendorPhone">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="vendorEmail" class="form-label">@Localizer["Email"]</label>
                            <input type="email" class="form-control" id="vendorEmail">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="vendorFax" class="form-label">@Localizer["Fax"]</label>
                            <input type="text" class="form-control" id="vendorFax">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="vendorFirstName" class="form-label">@Localizer["First Name"]</label>
                            <input type="text" class="form-control" id="vendorFirstName">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="vendorStreet" class="form-label">@Localizer["Street"]</label>
                            <input type="text" class="form-control" id="vendorStreet">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="vendorCity" class="form-label">@Localizer["City"]</label>
                            <input type="text" class="form-control" id="vendorCity">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="vendorStateProvince" class="form-label">@Localizer["State/Province"]</label>
                            <input type="text" class="form-control" id="vendorStateProvince">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="vendorCountry" class="form-label">@Localizer["Country"]</label>
                            <input type="text" class="form-control" id="vendorCountry">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="vendorPostalCode" class="form-label">@Localizer["Postal Code"]</label>
                            <input type="text" class="form-control" id="vendorPostalCode">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="vendorDoorNumber" class="form-label">@Localizer["Door Number"]</label>
                            <input type="text" class="form-control" id="vendorDoorNumber">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="vendorLandmark" class="form-label">@Localizer["Landmark"]</label>
                            <input type="text" class="form-control" id="vendorLandmark">
                        </div>
                        <div class="col-12 mb-3">
                            <label for="vendorDescription" class="form-label">@Localizer["Description"]</label>
                            <textarea class="form-control" id="vendorDescription" rows="3"></textarea>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times me-1"></i>
                    @Localizer["Cancel"]
                </button>
                <button type="button" class="btn btn-primary" onclick="saveVendor()">
                    <i class="fas fa-save me-1"></i>
                    @Localizer["Save"]
                </button>
            </div>
        </div>
    </div>
</div>

<script>
    function saveProduct() {
        const form = document.getElementById('addProductForm');
        if (!form.checkValidity()) {
            form.reportValidity();
            return;
        }

        const productData = {
            productType: document.getElementById('productType').value,
            productName: document.getElementById('productName').value,
            manufacturer: document.getElementById('manufacturer').value,
            partNo: document.getElementById('partNo').value || null,
            cost: parseFloat(document.getElementById('cost').value) || 0,
            description: document.getElementById('description').value || null
        };

        fetch('/Assets/CreateProduct', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(productData)
        })
            .then(response => response.text().then(text => {
                try {
                    return JSON.parse(text);
                } catch (e) {
                    throw new Error('Response was not JSON: ' + text);
                }
            }))
            .then(data => {
                if (data.success) {
                    const select = document.querySelector('select[name="ProductId"]');
                    const option = new Option(data.productName + ' - ' + data.manufacturer, data.id, true, true);
                    select.add(option);

                    const modal = bootstrap.Modal.getInstance(document.getElementById('addProductModal'));
                    modal.hide();
                    form.reset();
                    document.getElementById('productType').value = 'Mobile';

                    alert('@Localizer["Product added successfully"]');
                } else {
                    alert(' @Localizer["Error saving product"]' + ': ' + (data.message || '@Localizer["Unknown error"]'));
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert(' @Localizer["Error saving product"]' + ': ' + error.message);
            });
    }

    function saveVendor() {
        const form = document.getElementById('addVendorForm');
        if (!form.checkValidity()) {
            form.reportValidity();
            return;
        }

        const vendorData = {
            vendorName: document.getElementById('vendorName').value,
            currency: '@Localizer["SAR"]',
            doorNumber: document.getElementById('vendorDoorNumber').value || null,
            landmark: document.getElementById('vendorLandmark').value || null,
            postalCode: document.getElementById('vendorPostalCode').value || null,
            country: document.getElementById('vendorCountry').value || null,
            fax: document.getElementById('vendorFax').value || null,
            firstName: document.getElementById('vendorFirstName').value || null,
            street: document.getElementById('vendorStreet').value || null,
            city: document.getElementById('vendorCity').value || null,
            stateProvince: document.getElementById('vendorStateProvince').value || null,
            phoneNo: document.getElementById('vendorPhone').value || null,
            email: document.getElementById('vendorEmail').value || null,
            description: document.getElementById('vendorDescription').value || null
        };

        fetch('/Assets/CreateVendor', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(vendorData)
        })
            .then(response => response.text().then(text => {
                try {
                    return JSON.parse(text);
                } catch (e) {
                    throw new Error('Response was not JSON: ' + text);
                }
            }))
            .then(data => {
                if (data.success) {
                    const select = document.querySelector('select[name="VendorId"]');
                    const option = new Option(data.name, data.id, true, true);
                    select.add(option);

                    const modal = bootstrap.Modal.getInstance(document.getElementById('addVendorModal'));
                    modal.hide();
                    form.reset();

                    alert('@Localizer["Vendor added successfully"]');
                } else {
                    alert(' @Localizer["Error saving vendor"]' + ': ' + (data.message || '@Localizer["Unknown error"]'));
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert(' @Localizer["Error saving vendor"]' + ': ' + error.message);
            });
    }
</script>